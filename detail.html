<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - animation - keyframes</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">
    <link rel="stylesheet" type="text/css"
    href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600%7CSulphur+Point:400,700">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<style>
			body {
				background-color: #bfe3dd;
				color: #000;
			}

			a {
				color: #1ab48b;
        -webkit-appearance: none!important;
			}

      .modal .modal-content {
        border-radius: 20px;
      }
		</style>
	</head>

	<body>

		<div id="container"></div>

    <div class="modal banner-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Th√¥ng tin</h5>
            <a href="/images/sample_flyer.png" type="button" class="fa fa-download ml-2" download=""></a>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <img style="width: 100%;" src="/images/sample_flyer.png">
          </div>
        </div>
      </div>
    </div>
    

		<script type="module">

			import * as THREE from './build/three.module.js';

			import Stats from './jsm/libs/stats.module.js';

			import { OrbitControls } from './jsm/controls/OrbitControls.js';
			import { RoomEnvironment } from './jsm/environments/RoomEnvironment.js';

			import { GLTFLoader } from './jsm/loaders/GLTFLoader.js';
			import { DRACOLoader } from './jsm/loaders/DRACOLoader.js';

			let mixer;

			const clock = new THREE.Clock();
			const container = document.getElementById( 'container' );

			// const stats = new Stats();
			// container.appendChild( stats.dom );

			const renderer = new THREE.WebGLRenderer( { antialias: true } );
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.outputEncoding = THREE.sRGBEncoding;
			container.appendChild( renderer.domElement );

      renderer.domElement.addEventListener('click', onClick, false);

			const pmremGenerator = new THREE.PMREMGenerator( renderer );

			const scene = new THREE.Scene();
			scene.background = new THREE.Color( 0xe2e2e2 );
			scene.environment = pmremGenerator.fromScene( new RoomEnvironment(), 0.04 ).texture;

			const camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 100 );
			camera.position.set( 5, 2, 8 );

			const controls = new OrbitControls( camera, renderer.domElement );
			controls.target.set( 0, 0.5, 0 );
			controls.update();
			controls.enablePan = false;
			controls.enableDamping = true;

			const dracoLoader = new DRACOLoader();
			dracoLoader.setDecoderPath( 'js/libs/draco/gltf/' );

			const loader = new GLTFLoader();
			loader.setDRACOLoader( dracoLoader );
			loader.load( 'models/GH2/gianhang2.gltf', function ( gltf ) {

				const model = gltf.scene;
				model.position.set( 0, -1, 0 );
				//model.scale.set( 0.01, 0.01, 0.01 );
				scene.add( model );

				//mixer = new THREE.AnimationMixer( model );
				//mixer.clipAction( gltf.animations[ 0 ] ).play();

				animate();

			}, undefined, function ( e ) {

				console.error( e );

			} );


			window.onresize = function () {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			};


			function animate() {

				requestAnimationFrame( animate );

				//const delta = clock.getDelta();

				// mixer.update( delta );

				//controls.update();

				//stats.update();

				renderer.render( scene, camera );

			}
      var raycaster = new THREE.Raycaster();
      var mouse = new THREE.Vector2()

      function onClick( event ) {
        console.log('dmm click goi nha')
        event.preventDefault();

        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

        raycaster.setFromCamera( mouse, camera );

        var intersects = raycaster.intersectObjects( scene.children, true );

        if ( intersects.length > 0 ) {
          // console.log( 'Intersection:', intersects[ 0 ] );
          var clickedOn = intersects[0]
          console.log(`clicked on: ${clickedOn.object.name} - index: ${clickedOn.faceIndex}`)
          console.log(clickedOn)
          if (clickedOn.object.name === "model_map_poster_lightbox_mtl_50_StaticMeshComponent0") {
            console.log('hell yeah')
            $('.banner-modal').modal({
              keyboard: false
            })
          } else {
            console.log('booo booo')
          }
        }
      }

		</script>
	</body>

</html>